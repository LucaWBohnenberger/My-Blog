<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Luca WB">
<meta name="dcterms.date" content="2026-01-08">

<title>Building Neural Networks from Scratch – My Studies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Studies</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Luca Wolffenbuttel Bohnenberger</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/LucaWBohnenberger/my-blog"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Building Neural Networks from Scratch</h1>
            <p class="subtitle lead">Part 1</p>
                                <div class="quarto-categories">
                <div class="quarto-category">scratch</div>
                <div class="quarto-category">en</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">math</div>
                <div class="quarto-category">nn</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Luca WB </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 8, 2026</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">January 9, 2026</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="brief-summary" class="level2">
<h2 class="anchored" data-anchor-id="brief-summary">Brief summary</h2>
<p>The objective from this page to undestand how to implement a neural network from scratch without any external libraries, this page consider that you already have some knwlodge of Artificial Neural Networks. The main reason for this is just to make more compreensible the black box of Neural Networks. So, to this project, the main resource (but not the unique) are the series of videos from <a href="https://www.youtube.com/@AndrejKarpathy">Andrej Karpathy</a>. In this first part, I will cover how to implement AutoGrad for do backpropagation. At the end of this post, yo will cable of create MLPs without any external library.</p>
</section>
<section id="basic-knowledge-of-derivative" class="level2">
<h2 class="anchored" data-anchor-id="basic-knowledge-of-derivative">Basic knowledge of derivative</h2>
<p>So, from the start, to make sense at how an NN train and learn something, you first need a very good understanding around the meaning of derivative operations. A derivative is an operation that gives us a formula that describes the slope of a function as it modifies a variable, but for out prupose, we will only work with functions that generate linear derivatives. Thus, for the function $ f(x) = 3x^2 - 4x + 5 $, see the graph below.</p>
<div id="d15a6ac2" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show Python code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">4</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">5</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate x values</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">400</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> f(x)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="vs">r"$f(x) = 3x^2 - 4x + 5$"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>plt.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"f(x)"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Graph of the function"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-2-output-1.png" width="519" height="376" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This function is easy to undestand and derivate analytic, the derivate is <span class="math inline">\(\frac{df(x)}{dx} = 6x - 4\)</span>. Plotting both function and his derivate, we get the graphic below.</p>
<div id="e53d0c13" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show Python code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">4</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">5</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> df(x):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">6</span><span class="op">*</span>x <span class="op">-</span> <span class="dv">4</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate x values</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">400</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> f(x)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> df(x)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y, label<span class="op">=</span><span class="vs">r"$f(x) = 3x^2 - 4x + 5$"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y2, label<span class="op">=</span><span class="vs">r"$df(x) = 6*x - 4$"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>plt.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"f(x)"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Graph of the function"</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-3-output-1.png" width="521" height="376" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The basic idea is that with we want to minimize the value of a function (main objective in deep learning), we just need to see the value of a derivative in some point A, that give us all the information we need to go to the minimum spot. Just do some numerical exemple, in the graph above, note that the minimum spot is in som evalue around 0 and 2, more close to 0 (precisaly 2/3), so, just pick some rondom number, like -2, the value of <span class="math inline">\(f(x)\)</span> with -2 is 25, and the derivative is -16. The number -16 represent the rate at which the function varies for each increase in the value of x at that point in specific. So, with we increse the value of X a little bit, we can lower the value of X, so probably, the <span class="math inline">\(f(-1.999)\)</span> give us a lower value than <span class="math inline">\(f(-2)\)</span></p>
<div id="c0124a1b" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">4</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">5</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"f(-2)="</span>,f(<span class="op">-</span><span class="dv">2</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"f(-1.999)="</span>,f(<span class="op">-</span><span class="fl">1.999</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>f(-2)= 25
f(-1.999)= 24.984003</code></pre>
</div>
</div>
<p>This is the general idea of how we can minimize some function, that is also the main idea of how gradient descendent works.</p>
</section>
<section id="how-to-estimate-gradients" class="level2">
<h2 class="anchored" data-anchor-id="how-to-estimate-gradients">How to estimate gradients</h2>
<p>In general, to make an framework for working with nn, its just an AutoGrad (a tool that can do diferatiation automatically) and some fancy stuff for make more pratical.</p>
<p>For start, lets make things the most simple for now. Our goal its make an class that can calc for us all the gradietns (its the same as an derivative) from the function <span class="math inline">\(L = -2 \cdot \big((2 \cdot 3) + 10\big)\)</span>. But we dont are confortable derivate something with just numbers, so lets consider in this way the function:</p>
<div id="779dcede" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="op">-</span><span class="dv">2</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a<span class="op">*</span>b</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> d <span class="op">*</span> f</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>L</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1453">
<pre><code>-8.0</code></pre>
</div>
</div>
<p>Just to make clear, the knowledge that we want with this, is ow much changes in the final result, increase the values of any of the variables a little To get the gradients, we can use an aproximate that consists in adding a very small number <span class="math inline">\(h\)</span> is all of the values, than subtract the new with the original, and divide by the <span class="math inline">\(h\)</span>. The code below shows how to do this with the variable <span class="math inline">\(a\)</span>:</p>
<div id="3ee4ceab" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="op">-</span><span class="dv">2</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a<span class="op">*</span>b</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> d <span class="op">*</span> f</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="fl">0.0001</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">2</span> <span class="op">+</span> h</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">10</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="op">-</span><span class="dv">2</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a<span class="op">*</span>b</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>L2 <span class="op">=</span> d <span class="op">*</span> f</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L(2) = </span><span class="sc">{</span>L<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L(</span><span class="sc">{</span>a<span class="sc">}</span><span class="ss">) = </span><span class="sc">{</span>L2<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The slope/gradient: </span><span class="sc">{</span>(L2 <span class="op">-</span> L)<span class="op">/</span>h<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>L(2) = -8.0
L(2.0001) = -7.999399999999998
The slope/gradient: 6.000000000021544</code></pre>
</div>
</div>
<p>We will not use this method to create our autograd, but we can use this to verify with our gradients are right.</p>
</section>
<section id="lets-making-a-simple-autograd" class="level2">
<h2 class="anchored" data-anchor-id="lets-making-a-simple-autograd">Lets making a simple AutoGrad</h2>
<p>The basic idea of the AutoGrad we will make is make some very simple nodes, that represent the number in our calculation and will track all the last two nodes that make him. Basically, in <span class="math inline">\(L = -2 \cdot \big((2 \cdot 3) + 10\big)\)</span>, we will consider that a node can only save on number, like in the code represantation</p>
<div id="1c1b2ac6" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="op">-</span><span class="fl">3.0</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="op">-</span><span class="dv">2</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a<span class="op">*</span>b</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> d <span class="op">*</span> f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, for start, lets make the basic of our class:</p>
<div id="a4212ef6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Value:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data, _children<span class="op">=</span>(), _op<span class="op">=</span><span class="st">""</span>, label<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.grad <span class="op">=</span> <span class="dv">0</span> <span class="co"># All nodes will start with no grad, becouse we dont know what is the grad (and for other math reaseon will explain soon)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._prev <span class="op">=</span> <span class="bu">set</span>(_children) <span class="co"># Dont worry about this for know, we only use set for a little bit better performance</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._op <span class="op">=</span> _op <span class="co"># To save the operation, its usefull for debug</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label <span class="op">=</span> label <span class="co"># You can ignore this, its just for the graphs I make below</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is just for us visualize our class</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Value(data=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data<span class="sc">}</span><span class="ss">)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So with this class, we can create some Value’s, but we cant use them for anything, so lets make some operations</p>
<div id="6806968a" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Value:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data, _children<span class="op">=</span>(), _op<span class="op">=</span><span class="st">""</span>, label<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.grad <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._prev <span class="op">=</span> <span class="bu">set</span>(_children) </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._op <span class="op">=</span> _op</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label <span class="op">=</span> label <span class="co"># You can ignore this, its just for the graphs I make below</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is just for us visualize our class</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Value(data=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>, other):</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We just add the data, and return a Value object with new data, and with pointes for the two number that make the out number</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span>  Value(<span class="va">self</span>.data <span class="op">+</span> other.data, (<span class="va">self</span>,other), <span class="st">'+'</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, other):</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> Value(<span class="va">self</span>.data <span class="op">*</span> other.data, (<span class="va">self</span>,other), <span class="st">"*"</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with this simples class, we can know calc our formula (not the gradients yet)</p>
<div id="1b86d1a5" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> Value(<span class="fl">2.</span>, label<span class="op">=</span><span class="st">"a"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> Value(<span class="op">-</span><span class="fl">3.0</span>, label<span class="op">=</span><span class="st">"b"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Value(<span class="fl">10.</span>, label<span class="op">=</span><span class="st">"c"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> Value(<span class="op">-</span><span class="fl">2.</span>, label<span class="op">=</span><span class="st">"f"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a <span class="op">*</span> b<span class="op">;</span> e.label<span class="op">=</span><span class="st">"e"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c<span class="op">;</span> d.label<span class="op">=</span><span class="st">"d"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> d <span class="op">*</span> f<span class="op">;</span> L.label<span class="op">=</span><span class="st">"L"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>L</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1458">
<pre><code>Value(data=-8.0)</code></pre>
</div>
</div>
<p>This calculation moting the structure of a graph is known as pass forward Below, a just make an graph to visualize the operations (note that the operator is not an actual node, but for vizualize this is better), The question is, how we can get the gradients for <span class="math inline">\(L\)</span>, <span class="math inline">\(d\)</span> and <span class="math inline">\(f\)</span>?</p>
<div id="ca382b9b" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">

<div style="width: 100%; overflow-x: auto; background-color: white; border-radius: 8px; padding: 10px;">
    <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1332pt" height="155pt" viewbox="0.00 0.00 1332.00 155.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 1328,-151 1328,4 -4,4"></polygon>
<!-- 123679984281120 -->
<g id="node1" class="node">
<title>123679984281120</title>
<polygon fill="none" stroke="black" points="363,-110.5 363,-146.5 602,-146.5 602,-110.5 363,-110.5"></polygon>
<text text-anchor="middle" x="375" y="-124.8" font-family="Times,serif" font-size="14.00">c</text>
<polyline fill="none" stroke="black" points="387,-110.5 387,-146.5 "></polyline>
<text text-anchor="middle" x="442.5" y="-124.8" font-family="Times,serif" font-size="14.00">data 10.0000</text>
<polyline fill="none" stroke="black" points="498,-110.5 498,-146.5 "></polyline>
<text text-anchor="middle" x="550" y="-124.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679990276848+ -->
<g id="node4" class="node">
<title>123679990276848+</title>
<ellipse fill="none" stroke="black" cx="665" cy="-91.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="665" y="-87.8" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- 123679984281120&#45;&gt;123679990276848+ -->
<g id="edge4" class="edge">
<title>123679984281120-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M571.37,-110.49C591.67,-106.33 612.13,-102.13 628.64,-98.75"></path>
<polygon fill="black" stroke="black" points="629.78,-102.09 638.87,-96.65 628.37,-95.23 629.78,-102.09"></polygon>
</g>
<!-- 123679991916208 -->
<g id="node2" class="node">
<title>123679991916208</title>
<polygon fill="none" stroke="black" points="728,-0.5 728,-36.5 961,-36.5 961,-0.5 728,-0.5"></polygon>
<text text-anchor="middle" x="739" y="-14.8" font-family="Times,serif" font-size="14.00">f</text>
<polyline fill="none" stroke="black" points="750,-0.5 750,-36.5 "></polyline>
<text text-anchor="middle" x="803.5" y="-14.8" font-family="Times,serif" font-size="14.00">data -2.0000</text>
<polyline fill="none" stroke="black" points="857,-0.5 857,-36.5 "></polyline>
<text text-anchor="middle" x="909" y="-14.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679990275888* -->
<g id="node6" class="node">
<title>123679990275888*</title>
<ellipse fill="none" stroke="black" cx="1024" cy="-54.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="1024" y="-50.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679991916208&#45;&gt;123679990275888* -->
<g id="edge9" class="edge">
<title>123679991916208-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M934.51,-36.55C953.49,-40.4 972.45,-44.25 987.92,-47.39"></path>
<polygon fill="black" stroke="black" points="987.54,-50.88 998.03,-49.44 988.93,-44.02 987.54,-50.88"></polygon>
</g>
<!-- 123679990276848 -->
<g id="node3" class="node">
<title>123679990276848</title>
<polygon fill="none" stroke="black" points="728.5,-73.5 728.5,-109.5 960.5,-109.5 960.5,-73.5 728.5,-73.5"></polygon>
<text text-anchor="middle" x="741.5" y="-87.8" font-family="Times,serif" font-size="14.00">d</text>
<polyline fill="none" stroke="black" points="754.5,-73.5 754.5,-109.5 "></polyline>
<text text-anchor="middle" x="805.5" y="-87.8" font-family="Times,serif" font-size="14.00">data 4.0000</text>
<polyline fill="none" stroke="black" points="856.5,-73.5 856.5,-109.5 "></polyline>
<text text-anchor="middle" x="908.5" y="-87.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679990276848&#45;&gt;123679990275888* -->
<g id="edge6" class="edge">
<title>123679990276848-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M931.91,-73.49C951.73,-69.36 971.7,-65.19 987.87,-61.82"></path>
<polygon fill="black" stroke="black" points="988.84,-65.2 997.91,-59.73 987.41,-58.34 988.84,-65.2"></polygon>
</g>
<!-- 123679990276848+&#45;&gt;123679990276848 -->
<g id="edge1" class="edge">
<title>123679990276848+-&gt;123679990276848</title>
<path fill="none" stroke="black" d="M692.19,-91.5C699.78,-91.5 708.61,-91.5 718.11,-91.5"></path>
<polygon fill="black" stroke="black" points="718.24,-95 728.24,-91.5 718.24,-88 718.24,-95"></polygon>
</g>
<!-- 123679990275888 -->
<g id="node5" class="node">
<title>123679990275888</title>
<polygon fill="none" stroke="black" points="1087,-36.5 1087,-72.5 1324,-72.5 1324,-36.5 1087,-36.5"></polygon>
<text text-anchor="middle" x="1100" y="-50.8" font-family="Times,serif" font-size="14.00">L</text>
<polyline fill="none" stroke="black" points="1113,-36.5 1113,-72.5 "></polyline>
<text text-anchor="middle" x="1166.5" y="-50.8" font-family="Times,serif" font-size="14.00">data -8.0000</text>
<polyline fill="none" stroke="black" points="1220,-36.5 1220,-72.5 "></polyline>
<text text-anchor="middle" x="1272" y="-50.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679990275888*&#45;&gt;123679990275888 -->
<g id="edge2" class="edge">
<title>123679990275888*-&gt;123679990275888</title>
<path fill="none" stroke="black" d="M1051.1,-54.5C1058.61,-54.5 1067.33,-54.5 1076.75,-54.5"></path>
<polygon fill="black" stroke="black" points="1076.78,-58 1086.78,-54.5 1076.78,-51 1076.78,-58"></polygon>
</g>
<!-- 123679984274736 -->
<g id="node7" class="node">
<title>123679984274736</title>
<polygon fill="none" stroke="black" points="3,-74.5 3,-110.5 234,-110.5 234,-74.5 3,-74.5"></polygon>
<text text-anchor="middle" x="15.5" y="-88.8" font-family="Times,serif" font-size="14.00">a</text>
<polyline fill="none" stroke="black" points="28,-74.5 28,-110.5 "></polyline>
<text text-anchor="middle" x="79" y="-88.8" font-family="Times,serif" font-size="14.00">data 2.0000</text>
<polyline fill="none" stroke="black" points="130,-74.5 130,-110.5 "></polyline>
<text text-anchor="middle" x="182" y="-88.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679991916400* -->
<g id="node10" class="node">
<title>123679991916400*</title>
<ellipse fill="none" stroke="black" cx="300" cy="-55.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="300" y="-51.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679984274736&#45;&gt;123679991916400* -->
<g id="edge8" class="edge">
<title>123679984274736-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M206.88,-74.49C227.07,-70.33 247.42,-66.13 263.83,-62.75"></path>
<polygon fill="black" stroke="black" points="264.93,-66.1 274.01,-60.65 263.51,-59.24 264.93,-66.1"></polygon>
</g>
<!-- 123679987994960 -->
<g id="node8" class="node">
<title>123679987994960</title>
<polygon fill="none" stroke="black" points="0,-1.5 0,-37.5 237,-37.5 237,-1.5 0,-1.5"></polygon>
<text text-anchor="middle" x="13" y="-15.8" font-family="Times,serif" font-size="14.00">b</text>
<polyline fill="none" stroke="black" points="26,-1.5 26,-37.5 "></polyline>
<text text-anchor="middle" x="79.5" y="-15.8" font-family="Times,serif" font-size="14.00">data -3.0000</text>
<polyline fill="none" stroke="black" points="133,-1.5 133,-37.5 "></polyline>
<text text-anchor="middle" x="185" y="-15.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679987994960&#45;&gt;123679991916400* -->
<g id="edge7" class="edge">
<title>123679987994960-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M209.51,-37.55C228.7,-41.4 247.88,-45.25 263.53,-48.39"></path>
<polygon fill="black" stroke="black" points="263.26,-51.9 273.75,-50.44 264.64,-45.04 263.26,-51.9"></polygon>
</g>
<!-- 123679991916400 -->
<g id="node9" class="node">
<title>123679991916400</title>
<polygon fill="none" stroke="black" points="364.5,-37.5 364.5,-73.5 600.5,-73.5 600.5,-37.5 364.5,-37.5"></polygon>
<text text-anchor="middle" x="377" y="-51.8" font-family="Times,serif" font-size="14.00">e</text>
<polyline fill="none" stroke="black" points="389.5,-37.5 389.5,-73.5 "></polyline>
<text text-anchor="middle" x="443" y="-51.8" font-family="Times,serif" font-size="14.00">data -6.0000</text>
<polyline fill="none" stroke="black" points="496.5,-37.5 496.5,-73.5 "></polyline>
<text text-anchor="middle" x="548.5" y="-51.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679991916400&#45;&gt;123679990276848+ -->
<g id="edge5" class="edge">
<title>123679991916400-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M574.01,-73.55C593.64,-77.47 613.25,-81.38 629.13,-84.55"></path>
<polygon fill="black" stroke="black" points="628.5,-87.99 638.99,-86.51 629.87,-81.12 628.5,-87.99"></polygon>
</g>
<!-- 123679991916400*&#45;&gt;123679991916400 -->
<g id="edge3" class="edge">
<title>123679991916400*-&gt;123679991916400</title>
<path fill="none" stroke="black" d="M327.25,-55.5C335.09,-55.5 344.27,-55.5 354.17,-55.5"></path>
<polygon fill="black" stroke="black" points="354.28,-59 364.28,-55.5 354.28,-52 354.28,-59"></polygon>
</g>
</g>
</svg>

</div>
</div>
</div>
<p>For <span class="math inline">\(L\)</span>, I think it´s a little obvious, its just 1, from calculus, the derivative for the function <span class="math inline">\(f(x) = x\)</span> its 1. For <span class="math inline">\(d\)</span> and <span class="math inline">\(f\)</span>, we it´s simple too, from calculus, de derivative <span class="math inline">\(f(x) = zx\)</span> its just z, and this is the case for both <span class="math inline">\(d\)</span> and <span class="math inline">\(f\)</span>. See the equation below <span class="math display">\[
L(d,f) = d \cdot f
\]</span> <span class="math display">\[
\frac{\partial L}{\partial d} = f \quad \text{and} \quad \frac{\partial L}{\partial f} = d
\]</span></p>
<p>So, the gradient for <span class="math inline">\(d\)</span> is the value of data in <span class="math inline">\(f\)</span>, and for the <span class="math inline">\(f\)</span>, it´s the value of data in <span class="math inline">\(d\)</span>, in this case, the grad of <span class="math inline">\(d\)</span> is -2 and the grad of <span class="math inline">\(f\)</span> is 4.</p>
<div id="71ae3501" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">

<div style="width: 100%; overflow-x: auto; background-color: white; border-radius: 8px; padding: 10px;">
    <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1335pt" height="155pt" viewbox="0.00 0.00 1335.00 155.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 1331,-151 1331,4 -4,4"></polygon>
<!-- 123679984281120 -->
<g id="node1" class="node">
<title>123679984281120</title>
<polygon fill="none" stroke="black" points="363,-110.5 363,-146.5 602,-146.5 602,-110.5 363,-110.5"></polygon>
<text text-anchor="middle" x="375" y="-124.8" font-family="Times,serif" font-size="14.00">c</text>
<polyline fill="none" stroke="black" points="387,-110.5 387,-146.5 "></polyline>
<text text-anchor="middle" x="442.5" y="-124.8" font-family="Times,serif" font-size="14.00">data 10.0000</text>
<polyline fill="none" stroke="black" points="498,-110.5 498,-146.5 "></polyline>
<text text-anchor="middle" x="550" y="-124.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679990276848+ -->
<g id="node4" class="node">
<title>123679990276848+</title>
<ellipse fill="none" stroke="black" cx="665" cy="-91.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="665" y="-87.8" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- 123679984281120&#45;&gt;123679990276848+ -->
<g id="edge4" class="edge">
<title>123679984281120-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M571.37,-110.49C591.67,-106.33 612.13,-102.13 628.64,-98.75"></path>
<polygon fill="black" stroke="black" points="629.78,-102.09 638.87,-96.65 628.37,-95.23 629.78,-102.09"></polygon>
</g>
<!-- 123679991916208 -->
<g id="node2" class="node">
<title>123679991916208</title>
<polygon fill="none" stroke="black" points="729.5,-0.5 729.5,-36.5 962.5,-36.5 962.5,-0.5 729.5,-0.5"></polygon>
<text text-anchor="middle" x="740.5" y="-14.8" font-family="Times,serif" font-size="14.00">f</text>
<polyline fill="none" stroke="black" points="751.5,-0.5 751.5,-36.5 "></polyline>
<text text-anchor="middle" x="805" y="-14.8" font-family="Times,serif" font-size="14.00">data -2.0000</text>
<polyline fill="none" stroke="black" points="858.5,-0.5 858.5,-36.5 "></polyline>
<text text-anchor="middle" x="910.5" y="-14.8" font-family="Times,serif" font-size="14.00">grad 4.0000</text>
</g>
<!-- 123679990275888* -->
<g id="node6" class="node">
<title>123679990275888*</title>
<ellipse fill="none" stroke="black" cx="1027" cy="-54.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="1027" y="-50.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679991916208&#45;&gt;123679990275888* -->
<g id="edge9" class="edge">
<title>123679991916208-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M936.76,-36.55C955.9,-40.4 975.02,-44.25 990.62,-47.39"></path>
<polygon fill="black" stroke="black" points="990.33,-50.9 1000.82,-49.44 991.71,-44.03 990.33,-50.9"></polygon>
</g>
<!-- 123679990276848 -->
<g id="node3" class="node">
<title>123679990276848</title>
<polygon fill="none" stroke="black" points="728,-73.5 728,-109.5 964,-109.5 964,-73.5 728,-73.5"></polygon>
<text text-anchor="middle" x="741" y="-87.8" font-family="Times,serif" font-size="14.00">d</text>
<polyline fill="none" stroke="black" points="754,-73.5 754,-109.5 "></polyline>
<text text-anchor="middle" x="805" y="-87.8" font-family="Times,serif" font-size="14.00">data 4.0000</text>
<polyline fill="none" stroke="black" points="856,-73.5 856,-109.5 "></polyline>
<text text-anchor="middle" x="910" y="-87.8" font-family="Times,serif" font-size="14.00">grad -2.0000</text>
</g>
<!-- 123679990276848&#45;&gt;123679990275888* -->
<g id="edge6" class="edge">
<title>123679990276848-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M934.14,-73.49C954.27,-69.33 974.56,-65.13 990.93,-61.75"></path>
<polygon fill="black" stroke="black" points="992,-65.1 1001.08,-59.65 990.58,-58.25 992,-65.1"></polygon>
</g>
<!-- 123679990276848+&#45;&gt;123679990276848 -->
<g id="edge1" class="edge">
<title>123679990276848+-&gt;123679990276848</title>
<path fill="none" stroke="black" d="M692.03,-91.5C699.58,-91.5 708.38,-91.5 717.87,-91.5"></path>
<polygon fill="black" stroke="black" points="717.99,-95 727.99,-91.5 717.99,-88 717.99,-95"></polygon>
</g>
<!-- 123679990275888 -->
<g id="node5" class="node">
<title>123679990275888</title>
<polygon fill="none" stroke="black" points="1090,-36.5 1090,-72.5 1327,-72.5 1327,-36.5 1090,-36.5"></polygon>
<text text-anchor="middle" x="1103" y="-50.8" font-family="Times,serif" font-size="14.00">L</text>
<polyline fill="none" stroke="black" points="1116,-36.5 1116,-72.5 "></polyline>
<text text-anchor="middle" x="1169.5" y="-50.8" font-family="Times,serif" font-size="14.00">data -8.0000</text>
<polyline fill="none" stroke="black" points="1223,-36.5 1223,-72.5 "></polyline>
<text text-anchor="middle" x="1275" y="-50.8" font-family="Times,serif" font-size="14.00">grad 1.0000</text>
</g>
<!-- 123679990275888*&#45;&gt;123679990275888 -->
<g id="edge2" class="edge">
<title>123679990275888*-&gt;123679990275888</title>
<path fill="none" stroke="black" d="M1054.1,-54.5C1061.61,-54.5 1070.33,-54.5 1079.75,-54.5"></path>
<polygon fill="black" stroke="black" points="1079.78,-58 1089.78,-54.5 1079.78,-51 1079.78,-58"></polygon>
</g>
<!-- 123679984274736 -->
<g id="node7" class="node">
<title>123679984274736</title>
<polygon fill="none" stroke="black" points="3,-74.5 3,-110.5 234,-110.5 234,-74.5 3,-74.5"></polygon>
<text text-anchor="middle" x="15.5" y="-88.8" font-family="Times,serif" font-size="14.00">a</text>
<polyline fill="none" stroke="black" points="28,-74.5 28,-110.5 "></polyline>
<text text-anchor="middle" x="79" y="-88.8" font-family="Times,serif" font-size="14.00">data 2.0000</text>
<polyline fill="none" stroke="black" points="130,-74.5 130,-110.5 "></polyline>
<text text-anchor="middle" x="182" y="-88.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679991916400* -->
<g id="node10" class="node">
<title>123679991916400*</title>
<ellipse fill="none" stroke="black" cx="300" cy="-55.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="300" y="-51.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679984274736&#45;&gt;123679991916400* -->
<g id="edge8" class="edge">
<title>123679984274736-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M206.88,-74.49C227.07,-70.33 247.42,-66.13 263.83,-62.75"></path>
<polygon fill="black" stroke="black" points="264.93,-66.1 274.01,-60.65 263.51,-59.24 264.93,-66.1"></polygon>
</g>
<!-- 123679987994960 -->
<g id="node8" class="node">
<title>123679987994960</title>
<polygon fill="none" stroke="black" points="0,-1.5 0,-37.5 237,-37.5 237,-1.5 0,-1.5"></polygon>
<text text-anchor="middle" x="13" y="-15.8" font-family="Times,serif" font-size="14.00">b</text>
<polyline fill="none" stroke="black" points="26,-1.5 26,-37.5 "></polyline>
<text text-anchor="middle" x="79.5" y="-15.8" font-family="Times,serif" font-size="14.00">data -3.0000</text>
<polyline fill="none" stroke="black" points="133,-1.5 133,-37.5 "></polyline>
<text text-anchor="middle" x="185" y="-15.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679987994960&#45;&gt;123679991916400* -->
<g id="edge7" class="edge">
<title>123679987994960-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M209.51,-37.55C228.7,-41.4 247.88,-45.25 263.53,-48.39"></path>
<polygon fill="black" stroke="black" points="263.26,-51.9 273.75,-50.44 264.64,-45.04 263.26,-51.9"></polygon>
</g>
<!-- 123679991916400 -->
<g id="node9" class="node">
<title>123679991916400</title>
<polygon fill="none" stroke="black" points="364.5,-37.5 364.5,-73.5 600.5,-73.5 600.5,-37.5 364.5,-37.5"></polygon>
<text text-anchor="middle" x="377" y="-51.8" font-family="Times,serif" font-size="14.00">e</text>
<polyline fill="none" stroke="black" points="389.5,-37.5 389.5,-73.5 "></polyline>
<text text-anchor="middle" x="443" y="-51.8" font-family="Times,serif" font-size="14.00">data -6.0000</text>
<polyline fill="none" stroke="black" points="496.5,-37.5 496.5,-73.5 "></polyline>
<text text-anchor="middle" x="548.5" y="-51.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679991916400&#45;&gt;123679990276848+ -->
<g id="edge5" class="edge">
<title>123679991916400-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M574.01,-73.55C593.64,-77.47 613.25,-81.38 629.13,-84.55"></path>
<polygon fill="black" stroke="black" points="628.5,-87.99 638.99,-86.51 629.87,-81.12 628.5,-87.99"></polygon>
</g>
<!-- 123679991916400*&#45;&gt;123679991916400 -->
<g id="edge3" class="edge">
<title>123679991916400*-&gt;123679991916400</title>
<path fill="none" stroke="black" d="M327.25,-55.5C335.09,-55.5 344.27,-55.5 354.17,-55.5"></path>
<polygon fill="black" stroke="black" points="354.28,-59 364.28,-55.5 354.28,-52 354.28,-59"></polygon>
</g>
</g>
</svg>

</div>
</div>
</div>
<p>Now its start being interesting, we want to calc the gradient of <span class="math inline">\(e\)</span> and <span class="math inline">\(c\)</span> in relation of <span class="math inline">\(L\)</span>. From the chain of rule, we have the expression below: <span class="math display">\[
\frac{\partial L}{\partial e} = \frac{\partial L}{\partial d} \cdot \frac{\partial d}{\partial e}
\]</span> Bascially, it´s saying that the gradient of <span class="math inline">\(e\)</span> in relation with <span class="math inline">\(L\)</span> it´s just the gradient of <span class="math inline">\(d\)</span> in relation with <span class="math inline">\(L\)</span> time <span class="math inline">\(e\)</span> in relation with <span class="math inline">\(d\)</span>. This mean that we only have to calc the local gradient <span class="math inline">\(\frac{\partial d}{\partial e}\)</span> because we already have calc the <span class="math inline">\(\frac{\partial L}{\partial d}\)</span> and its save in d.grad. The same with <span class="math inline">\(c\)</span> it´s true. So, from calculus, the gradient from an expression like <span class="math inline">\(f(x,y) = x + y\)</span> its 1 for both <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. Thus, we have</p>
<p><span class="math display">\[
\frac{\partial d}{\partial e} = 1
\quad \text{and}  \quad
\frac{\partial d}{\partial c} = 1
\]</span> <span class="math display">\[
\frac{\partial L}{\partial e} = \frac{\partial L}{\partial d} \cdot \frac{\partial d}{\partial e} = -2 \cdot 1 = -2
\quad \text{and}  \quad
\frac{\partial L}{\partial e} = \frac{\partial L}{\partial d} \cdot \frac{\partial d}{\partial c} = -2 \cdot 1 = -2
\]</span></p>
<p>This is the strong concept that make the AutoGrad work, we only need to calc the local gradient and multiply with the gradient from the father of nodes (because the gradient of the father already is in relation with the last node).</p>
<div id="f2043cbf" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">

<div style="width: 100%; overflow-x: auto; background-color: white; border-radius: 8px; padding: 10px;">
    <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1339pt" height="155pt" viewbox="0.00 0.00 1339.00 155.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 1335,-151 1335,4 -4,4"></polygon>
<!-- 123679984281120 -->
<g id="node1" class="node">
<title>123679984281120</title>
<polygon fill="none" stroke="black" points="363,-110.5 363,-146.5 606,-146.5 606,-110.5 363,-110.5"></polygon>
<text text-anchor="middle" x="375" y="-124.8" font-family="Times,serif" font-size="14.00">c</text>
<polyline fill="none" stroke="black" points="387,-110.5 387,-146.5 "></polyline>
<text text-anchor="middle" x="442.5" y="-124.8" font-family="Times,serif" font-size="14.00">data 10.0000</text>
<polyline fill="none" stroke="black" points="498,-110.5 498,-146.5 "></polyline>
<text text-anchor="middle" x="552" y="-124.8" font-family="Times,serif" font-size="14.00">grad -2.0000</text>
</g>
<!-- 123679990276848+ -->
<g id="node4" class="node">
<title>123679990276848+</title>
<ellipse fill="none" stroke="black" cx="669" cy="-91.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="669" y="-87.8" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- 123679984281120&#45;&gt;123679990276848+ -->
<g id="edge4" class="edge">
<title>123679984281120-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M574.34,-110.49C595.21,-106.26 616.25,-101.99 633.09,-98.58"></path>
<polygon fill="black" stroke="black" points="633.88,-101.99 642.99,-96.57 632.49,-95.13 633.88,-101.99"></polygon>
</g>
<!-- 123679991916208 -->
<g id="node2" class="node">
<title>123679991916208</title>
<polygon fill="none" stroke="black" points="733.5,-0.5 733.5,-36.5 966.5,-36.5 966.5,-0.5 733.5,-0.5"></polygon>
<text text-anchor="middle" x="744.5" y="-14.8" font-family="Times,serif" font-size="14.00">f</text>
<polyline fill="none" stroke="black" points="755.5,-0.5 755.5,-36.5 "></polyline>
<text text-anchor="middle" x="809" y="-14.8" font-family="Times,serif" font-size="14.00">data -2.0000</text>
<polyline fill="none" stroke="black" points="862.5,-0.5 862.5,-36.5 "></polyline>
<text text-anchor="middle" x="914.5" y="-14.8" font-family="Times,serif" font-size="14.00">grad 4.0000</text>
</g>
<!-- 123679990275888* -->
<g id="node6" class="node">
<title>123679990275888*</title>
<ellipse fill="none" stroke="black" cx="1031" cy="-54.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="1031" y="-50.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679991916208&#45;&gt;123679990275888* -->
<g id="edge9" class="edge">
<title>123679991916208-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M940.76,-36.55C959.9,-40.4 979.02,-44.25 994.62,-47.39"></path>
<polygon fill="black" stroke="black" points="994.33,-50.9 1004.82,-49.44 995.71,-44.03 994.33,-50.9"></polygon>
</g>
<!-- 123679990276848 -->
<g id="node3" class="node">
<title>123679990276848</title>
<polygon fill="none" stroke="black" points="732,-73.5 732,-109.5 968,-109.5 968,-73.5 732,-73.5"></polygon>
<text text-anchor="middle" x="745" y="-87.8" font-family="Times,serif" font-size="14.00">d</text>
<polyline fill="none" stroke="black" points="758,-73.5 758,-109.5 "></polyline>
<text text-anchor="middle" x="809" y="-87.8" font-family="Times,serif" font-size="14.00">data 4.0000</text>
<polyline fill="none" stroke="black" points="860,-73.5 860,-109.5 "></polyline>
<text text-anchor="middle" x="914" y="-87.8" font-family="Times,serif" font-size="14.00">grad -2.0000</text>
</g>
<!-- 123679990276848&#45;&gt;123679990275888* -->
<g id="edge6" class="edge">
<title>123679990276848-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M938.14,-73.49C958.27,-69.33 978.56,-65.13 994.93,-61.75"></path>
<polygon fill="black" stroke="black" points="996,-65.1 1005.08,-59.65 994.58,-58.25 996,-65.1"></polygon>
</g>
<!-- 123679990276848+&#45;&gt;123679990276848 -->
<g id="edge1" class="edge">
<title>123679990276848+-&gt;123679990276848</title>
<path fill="none" stroke="black" d="M696.03,-91.5C703.58,-91.5 712.38,-91.5 721.87,-91.5"></path>
<polygon fill="black" stroke="black" points="721.99,-95 731.99,-91.5 721.99,-88 721.99,-95"></polygon>
</g>
<!-- 123679990275888 -->
<g id="node5" class="node">
<title>123679990275888</title>
<polygon fill="none" stroke="black" points="1094,-36.5 1094,-72.5 1331,-72.5 1331,-36.5 1094,-36.5"></polygon>
<text text-anchor="middle" x="1107" y="-50.8" font-family="Times,serif" font-size="14.00">L</text>
<polyline fill="none" stroke="black" points="1120,-36.5 1120,-72.5 "></polyline>
<text text-anchor="middle" x="1173.5" y="-50.8" font-family="Times,serif" font-size="14.00">data -8.0000</text>
<polyline fill="none" stroke="black" points="1227,-36.5 1227,-72.5 "></polyline>
<text text-anchor="middle" x="1279" y="-50.8" font-family="Times,serif" font-size="14.00">grad 1.0000</text>
</g>
<!-- 123679990275888*&#45;&gt;123679990275888 -->
<g id="edge2" class="edge">
<title>123679990275888*-&gt;123679990275888</title>
<path fill="none" stroke="black" d="M1058.1,-54.5C1065.61,-54.5 1074.33,-54.5 1083.75,-54.5"></path>
<polygon fill="black" stroke="black" points="1083.78,-58 1093.78,-54.5 1083.78,-51 1083.78,-58"></polygon>
</g>
<!-- 123679984274736 -->
<g id="node7" class="node">
<title>123679984274736</title>
<polygon fill="none" stroke="black" points="3,-74.5 3,-110.5 234,-110.5 234,-74.5 3,-74.5"></polygon>
<text text-anchor="middle" x="15.5" y="-88.8" font-family="Times,serif" font-size="14.00">a</text>
<polyline fill="none" stroke="black" points="28,-74.5 28,-110.5 "></polyline>
<text text-anchor="middle" x="79" y="-88.8" font-family="Times,serif" font-size="14.00">data 2.0000</text>
<polyline fill="none" stroke="black" points="130,-74.5 130,-110.5 "></polyline>
<text text-anchor="middle" x="182" y="-88.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679991916400* -->
<g id="node10" class="node">
<title>123679991916400*</title>
<ellipse fill="none" stroke="black" cx="300" cy="-55.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="300" y="-51.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679984274736&#45;&gt;123679991916400* -->
<g id="edge8" class="edge">
<title>123679984274736-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M206.88,-74.49C227.07,-70.33 247.42,-66.13 263.83,-62.75"></path>
<polygon fill="black" stroke="black" points="264.93,-66.1 274.01,-60.65 263.51,-59.24 264.93,-66.1"></polygon>
</g>
<!-- 123679987994960 -->
<g id="node8" class="node">
<title>123679987994960</title>
<polygon fill="none" stroke="black" points="0,-1.5 0,-37.5 237,-37.5 237,-1.5 0,-1.5"></polygon>
<text text-anchor="middle" x="13" y="-15.8" font-family="Times,serif" font-size="14.00">b</text>
<polyline fill="none" stroke="black" points="26,-1.5 26,-37.5 "></polyline>
<text text-anchor="middle" x="79.5" y="-15.8" font-family="Times,serif" font-size="14.00">data -3.0000</text>
<polyline fill="none" stroke="black" points="133,-1.5 133,-37.5 "></polyline>
<text text-anchor="middle" x="185" y="-15.8" font-family="Times,serif" font-size="14.00">grad 0.0000</text>
</g>
<!-- 123679987994960&#45;&gt;123679991916400* -->
<g id="edge7" class="edge">
<title>123679987994960-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M209.51,-37.55C228.7,-41.4 247.88,-45.25 263.53,-48.39"></path>
<polygon fill="black" stroke="black" points="263.26,-51.9 273.75,-50.44 264.64,-45.04 263.26,-51.9"></polygon>
</g>
<!-- 123679991916400 -->
<g id="node9" class="node">
<title>123679991916400</title>
<polygon fill="none" stroke="black" points="364.5,-37.5 364.5,-73.5 604.5,-73.5 604.5,-37.5 364.5,-37.5"></polygon>
<text text-anchor="middle" x="377" y="-51.8" font-family="Times,serif" font-size="14.00">e</text>
<polyline fill="none" stroke="black" points="389.5,-37.5 389.5,-73.5 "></polyline>
<text text-anchor="middle" x="443" y="-51.8" font-family="Times,serif" font-size="14.00">data -6.0000</text>
<polyline fill="none" stroke="black" points="496.5,-37.5 496.5,-73.5 "></polyline>
<text text-anchor="middle" x="550.5" y="-51.8" font-family="Times,serif" font-size="14.00">grad -2.0000</text>
</g>
<!-- 123679991916400&#45;&gt;123679990276848+ -->
<g id="edge5" class="edge">
<title>123679991916400-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M577.02,-73.55C596.86,-77.47 616.69,-81.38 632.74,-84.55"></path>
<polygon fill="black" stroke="black" points="632.23,-88.01 642.71,-86.51 633.58,-81.14 632.23,-88.01"></polygon>
</g>
<!-- 123679991916400*&#45;&gt;123679991916400 -->
<g id="edge3" class="edge">
<title>123679991916400*-&gt;123679991916400</title>
<path fill="none" stroke="black" d="M327.15,-55.5C334.98,-55.5 344.16,-55.5 354.06,-55.5"></path>
<polygon fill="black" stroke="black" points="354.19,-59 364.19,-55.5 354.19,-52 354.19,-59"></polygon>
</g>
</g>
</svg>

</div>
</div>
</div>
<p>So for the last two variables <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, its another multiplication, so the local grad of <span class="math inline">\(b\)</span> its data of <span class="math inline">\(a\)</span>, and for <span class="math inline">\(a\)</span> its data from <span class="math inline">\(b\)</span>. Put in a code, its just</p>
<div id="d8adda7d" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>L.grad <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>d.grad <span class="op">=</span> f.data</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>f.grad <span class="op">=</span> d.data</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>e.grad <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> d.grad</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>c.grad <span class="op">=</span> <span class="dv">1</span> <span class="op">*</span> d.grad</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>a.grad <span class="op">=</span> b.data <span class="op">*</span> e.grad</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>b.grad <span class="op">=</span> a.data <span class="op">*</span> e.grad</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="760fd7dd" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">

<div style="width: 100%; overflow-x: auto; background-color: white; border-radius: 8px; padding: 10px;">
    <!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="1343pt" height="155pt" viewbox="0.00 0.00 1343.00 155.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 151)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-151 1339,-151 1339,4 -4,4"></polygon>
<!-- 123679984281120 -->
<g id="node1" class="node">
<title>123679984281120</title>
<polygon fill="none" stroke="black" points="367,-110.5 367,-146.5 610,-146.5 610,-110.5 367,-110.5"></polygon>
<text text-anchor="middle" x="379" y="-124.8" font-family="Times,serif" font-size="14.00">c</text>
<polyline fill="none" stroke="black" points="391,-110.5 391,-146.5 "></polyline>
<text text-anchor="middle" x="446.5" y="-124.8" font-family="Times,serif" font-size="14.00">data 10.0000</text>
<polyline fill="none" stroke="black" points="502,-110.5 502,-146.5 "></polyline>
<text text-anchor="middle" x="556" y="-124.8" font-family="Times,serif" font-size="14.00">grad -2.0000</text>
</g>
<!-- 123679990276848+ -->
<g id="node4" class="node">
<title>123679990276848+</title>
<ellipse fill="none" stroke="black" cx="673" cy="-91.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="673" y="-87.8" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- 123679984281120&#45;&gt;123679990276848+ -->
<g id="edge4" class="edge">
<title>123679984281120-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M578.34,-110.49C599.21,-106.26 620.25,-101.99 637.09,-98.58"></path>
<polygon fill="black" stroke="black" points="637.88,-101.99 646.99,-96.57 636.49,-95.13 637.88,-101.99"></polygon>
</g>
<!-- 123679991916208 -->
<g id="node2" class="node">
<title>123679991916208</title>
<polygon fill="none" stroke="black" points="737.5,-0.5 737.5,-36.5 970.5,-36.5 970.5,-0.5 737.5,-0.5"></polygon>
<text text-anchor="middle" x="748.5" y="-14.8" font-family="Times,serif" font-size="14.00">f</text>
<polyline fill="none" stroke="black" points="759.5,-0.5 759.5,-36.5 "></polyline>
<text text-anchor="middle" x="813" y="-14.8" font-family="Times,serif" font-size="14.00">data -2.0000</text>
<polyline fill="none" stroke="black" points="866.5,-0.5 866.5,-36.5 "></polyline>
<text text-anchor="middle" x="918.5" y="-14.8" font-family="Times,serif" font-size="14.00">grad 4.0000</text>
</g>
<!-- 123679990275888* -->
<g id="node6" class="node">
<title>123679990275888*</title>
<ellipse fill="none" stroke="black" cx="1035" cy="-54.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="1035" y="-50.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679991916208&#45;&gt;123679990275888* -->
<g id="edge9" class="edge">
<title>123679991916208-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M944.76,-36.55C963.9,-40.4 983.02,-44.25 998.62,-47.39"></path>
<polygon fill="black" stroke="black" points="998.33,-50.9 1008.82,-49.44 999.71,-44.03 998.33,-50.9"></polygon>
</g>
<!-- 123679990276848 -->
<g id="node3" class="node">
<title>123679990276848</title>
<polygon fill="none" stroke="black" points="736,-73.5 736,-109.5 972,-109.5 972,-73.5 736,-73.5"></polygon>
<text text-anchor="middle" x="749" y="-87.8" font-family="Times,serif" font-size="14.00">d</text>
<polyline fill="none" stroke="black" points="762,-73.5 762,-109.5 "></polyline>
<text text-anchor="middle" x="813" y="-87.8" font-family="Times,serif" font-size="14.00">data 4.0000</text>
<polyline fill="none" stroke="black" points="864,-73.5 864,-109.5 "></polyline>
<text text-anchor="middle" x="918" y="-87.8" font-family="Times,serif" font-size="14.00">grad -2.0000</text>
</g>
<!-- 123679990276848&#45;&gt;123679990275888* -->
<g id="edge6" class="edge">
<title>123679990276848-&gt;123679990275888*</title>
<path fill="none" stroke="black" d="M942.14,-73.49C962.27,-69.33 982.56,-65.13 998.93,-61.75"></path>
<polygon fill="black" stroke="black" points="1000,-65.1 1009.08,-59.65 998.58,-58.25 1000,-65.1"></polygon>
</g>
<!-- 123679990276848+&#45;&gt;123679990276848 -->
<g id="edge1" class="edge">
<title>123679990276848+-&gt;123679990276848</title>
<path fill="none" stroke="black" d="M700.03,-91.5C707.58,-91.5 716.38,-91.5 725.87,-91.5"></path>
<polygon fill="black" stroke="black" points="725.99,-95 735.99,-91.5 725.99,-88 725.99,-95"></polygon>
</g>
<!-- 123679990275888 -->
<g id="node5" class="node">
<title>123679990275888</title>
<polygon fill="none" stroke="black" points="1098,-36.5 1098,-72.5 1335,-72.5 1335,-36.5 1098,-36.5"></polygon>
<text text-anchor="middle" x="1111" y="-50.8" font-family="Times,serif" font-size="14.00">L</text>
<polyline fill="none" stroke="black" points="1124,-36.5 1124,-72.5 "></polyline>
<text text-anchor="middle" x="1177.5" y="-50.8" font-family="Times,serif" font-size="14.00">data -8.0000</text>
<polyline fill="none" stroke="black" points="1231,-36.5 1231,-72.5 "></polyline>
<text text-anchor="middle" x="1283" y="-50.8" font-family="Times,serif" font-size="14.00">grad 1.0000</text>
</g>
<!-- 123679990275888*&#45;&gt;123679990275888 -->
<g id="edge2" class="edge">
<title>123679990275888*-&gt;123679990275888</title>
<path fill="none" stroke="black" d="M1062.1,-54.5C1069.61,-54.5 1078.33,-54.5 1087.75,-54.5"></path>
<polygon fill="black" stroke="black" points="1087.78,-58 1097.78,-54.5 1087.78,-51 1087.78,-58"></polygon>
</g>
<!-- 123679984274736 -->
<g id="node7" class="node">
<title>123679984274736</title>
<polygon fill="none" stroke="black" points="5,-74.5 5,-110.5 236,-110.5 236,-74.5 5,-74.5"></polygon>
<text text-anchor="middle" x="17.5" y="-88.8" font-family="Times,serif" font-size="14.00">a</text>
<polyline fill="none" stroke="black" points="30,-74.5 30,-110.5 "></polyline>
<text text-anchor="middle" x="81" y="-88.8" font-family="Times,serif" font-size="14.00">data 2.0000</text>
<polyline fill="none" stroke="black" points="132,-74.5 132,-110.5 "></polyline>
<text text-anchor="middle" x="184" y="-88.8" font-family="Times,serif" font-size="14.00">grad 6.0000</text>
</g>
<!-- 123679991916400* -->
<g id="node10" class="node">
<title>123679991916400*</title>
<ellipse fill="none" stroke="black" cx="304" cy="-55.5" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="304" y="-51.8" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- 123679984274736&#45;&gt;123679991916400* -->
<g id="edge8" class="edge">
<title>123679984274736-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M209.86,-74.49C230.46,-70.29 251.23,-66.05 267.91,-62.65"></path>
<polygon fill="black" stroke="black" points="268.64,-66.08 277.73,-60.65 267.24,-59.22 268.64,-66.08"></polygon>
</g>
<!-- 123679987994960 -->
<g id="node8" class="node">
<title>123679987994960</title>
<polygon fill="none" stroke="black" points="0,-1.5 0,-37.5 241,-37.5 241,-1.5 0,-1.5"></polygon>
<text text-anchor="middle" x="13" y="-15.8" font-family="Times,serif" font-size="14.00">b</text>
<polyline fill="none" stroke="black" points="26,-1.5 26,-37.5 "></polyline>
<text text-anchor="middle" x="79.5" y="-15.8" font-family="Times,serif" font-size="14.00">data -3.0000</text>
<polyline fill="none" stroke="black" points="133,-1.5 133,-37.5 "></polyline>
<text text-anchor="middle" x="187" y="-15.8" font-family="Times,serif" font-size="14.00">grad -4.0000</text>
</g>
<!-- 123679987994960&#45;&gt;123679991916400* -->
<g id="edge7" class="edge">
<title>123679987994960-&gt;123679991916400*</title>
<path fill="none" stroke="black" d="M212.52,-37.55C232.25,-41.47 251.97,-45.38 267.94,-48.55"></path>
<polygon fill="black" stroke="black" points="267.36,-52 277.85,-50.51 268.72,-45.13 267.36,-52"></polygon>
</g>
<!-- 123679991916400 -->
<g id="node9" class="node">
<title>123679991916400</title>
<polygon fill="none" stroke="black" points="368.5,-37.5 368.5,-73.5 608.5,-73.5 608.5,-37.5 368.5,-37.5"></polygon>
<text text-anchor="middle" x="381" y="-51.8" font-family="Times,serif" font-size="14.00">e</text>
<polyline fill="none" stroke="black" points="393.5,-37.5 393.5,-73.5 "></polyline>
<text text-anchor="middle" x="447" y="-51.8" font-family="Times,serif" font-size="14.00">data -6.0000</text>
<polyline fill="none" stroke="black" points="500.5,-37.5 500.5,-73.5 "></polyline>
<text text-anchor="middle" x="554.5" y="-51.8" font-family="Times,serif" font-size="14.00">grad -2.0000</text>
</g>
<!-- 123679991916400&#45;&gt;123679990276848+ -->
<g id="edge5" class="edge">
<title>123679991916400-&gt;123679990276848+</title>
<path fill="none" stroke="black" d="M581.02,-73.55C600.86,-77.47 620.69,-81.38 636.74,-84.55"></path>
<polygon fill="black" stroke="black" points="636.23,-88.01 646.71,-86.51 637.58,-81.14 636.23,-88.01"></polygon>
</g>
<!-- 123679991916400*&#45;&gt;123679991916400 -->
<g id="edge3" class="edge">
<title>123679991916400*-&gt;123679991916400</title>
<path fill="none" stroke="black" d="M331.15,-55.5C338.98,-55.5 348.16,-55.5 358.06,-55.5"></path>
<polygon fill="black" stroke="black" points="358.19,-59 368.19,-55.5 358.19,-52 358.19,-59"></polygon>
</g>
</g>
</svg>

</div>
</div>
</div>
<p>This is a complete backward pass manual, know we need to make a code to this automatically for us</p>
<section id="automatically-backward-pass" class="level3">
<h3 class="anchored" data-anchor-id="automatically-backward-pass">Automatically backward pass</h3>
<p>To make this automatically, we probably notted that we need to start from the last node and go in a reverse order, this is necessery because for calc the gradient of and node, we need the local gradient of the variable, and the gradient of the father, the unique exception is the last node, because its gradient always will be 1. The way will we implement this, its just make a node do the calc of his childs gradients, lets see the mul function:</p>
<div id="390d696c" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Value:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data, _children<span class="op">=</span>(), _op<span class="op">=</span><span class="st">""</span>, label<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.grad <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backward <span class="op">=</span> <span class="va">None</span> <span class="co"># Add this new parameter too save the func</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._prev <span class="op">=</span> <span class="bu">set</span>(_children) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._op <span class="op">=</span> _op</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label <span class="op">=</span> label </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, other):</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span>  Value(<span class="va">self</span>.data <span class="op">*</span> other.data, (<span class="va">self</span>,other), <span class="st">'+'</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _backward():</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># We use += over =, because with we use the same node two times it will be reset, and with this node influences in two other nodes, its influence in final result, are the sum of the influence on both nodes</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.grad <span class="op">+=</span> other.data <span class="op">*</span> out.grad </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            other.grad <span class="op">+=</span> <span class="va">self</span>.data <span class="op">*</span> out.grad</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        out._backward <span class="op">=</span> _backward</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets check with this can calc the gradients of <span class="math inline">\(d\)</span> and <span class="math inline">\(f\)</span></p>
<div id="9471c146" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> Value(<span class="fl">2.</span>, label<span class="op">=</span><span class="st">"a"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> Value(<span class="op">-</span><span class="fl">3.0</span>, label<span class="op">=</span><span class="st">"b"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Value(<span class="fl">10.</span>, label<span class="op">=</span><span class="st">"c"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> Value(<span class="op">-</span><span class="fl">2.</span>, label<span class="op">=</span><span class="st">"f"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a <span class="op">*</span> b<span class="op">;</span> e.label<span class="op">=</span><span class="st">"e"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c<span class="op">;</span> d.label<span class="op">=</span><span class="st">"d"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> d <span class="op">*</span> f<span class="op">;</span> L.label<span class="op">=</span><span class="st">"L"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>L.grad <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>L._backward()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Grad of d:"</span>, d.grad)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Grad of f:"</span>, f.grad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Grad of d: -2.0
Grad of f: 4.0</code></pre>
</div>
</div>
<p>It works! So know, its just do for add too, below are the complete Value class</p>
<div id="83c0bbaf" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show Python code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Value:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data, _children<span class="op">=</span>(), _op<span class="op">=</span><span class="st">""</span>, label<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.grad <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backward <span class="op">=</span> <span class="kw">lambda</span>: <span class="va">None</span> <span class="co"># Add this new parameter too save the func</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._prev <span class="op">=</span> <span class="bu">set</span>(_children) </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._op <span class="op">=</span> _op</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label <span class="op">=</span> label </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, other):</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span>  Value(<span class="va">self</span>.data <span class="op">*</span> other.data, (<span class="va">self</span>,other), <span class="st">'+'</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _backward():</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.grad <span class="op">+=</span> other.data <span class="op">*</span> out.grad </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>            other.grad <span class="op">+=</span> <span class="va">self</span>.data <span class="op">*</span> out.grad</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        out._backward <span class="op">=</span> _backward</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is just for us visualize our class</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Value(data=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>, other):</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We just add the data, and return a Value object with new data, and with pointes for the two number that make the out number</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span>  Value(<span class="va">self</span>.data <span class="op">+</span> other.data, (<span class="va">self</span>,other), <span class="st">'+'</span>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _backward():</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.grad <span class="op">+=</span> out.grad </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>            other.grad <span class="op">+=</span> out.grad</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        out._backward <span class="op">=</span> _backward</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Lets check with we can calc all the gradients:</p>
<div id="6d7b564b" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> Value(<span class="fl">2.</span>, label<span class="op">=</span><span class="st">"a"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> Value(<span class="op">-</span><span class="fl">3.0</span>, label<span class="op">=</span><span class="st">"b"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Value(<span class="fl">10.</span>, label<span class="op">=</span><span class="st">"c"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> Value(<span class="op">-</span><span class="fl">2.</span>, label<span class="op">=</span><span class="st">"f"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a <span class="op">*</span> b<span class="op">;</span> e.label<span class="op">=</span><span class="st">"e"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c<span class="op">;</span> d.label<span class="op">=</span><span class="st">"d"</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> d <span class="op">*</span> f<span class="op">;</span> L.label<span class="op">=</span><span class="st">"L"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>L.grad <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>L._backward() <span class="co"># Node L: Propagates gradient to d and f</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>d._backward() <span class="co"># Node d: Propagates gradient to e and c</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>f._backward() <span class="co"># Node f (Leaf): Does nothing (empty lambda)</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>e._backward() <span class="co"># Node e: Propagates gradient to a and b</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>c._backward() <span class="co"># Node c (Leaf): Does nothing</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>b._backward() <span class="co"># Node b (Leaf): Does nothing</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>a._backward() <span class="co"># Node a (Leaf): Does nothing</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L data: </span><span class="sc">{</span>L<span class="sc">.</span>data<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">20</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of L: </span><span class="sc">{</span>L<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be 1</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of f: </span><span class="sc">{</span>f<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be 4.0 (d.data)</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of d: </span><span class="sc">{</span>d<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -2.0 (f.data)</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of c: </span><span class="sc">{</span>c<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -2.0 (1 * d.grad)</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of e: </span><span class="sc">{</span>e<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -2.0 (1 * d.grad)</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of b: </span><span class="sc">{</span>b<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -4.0 (a.data * e.grad -&gt; 2 * -2)</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of a: </span><span class="sc">{</span>a<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be 6.0 (b.data * e.grad -&gt; -3 * -2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>L data: -8.0
--------------------
Grad of L: 1
Grad of f: 4.0
Grad of d: -2.0
Grad of c: -2.0
Grad of e: -2.0
Grad of b: -4.0
Grad of a: 6.0</code></pre>
</div>
</div>
<p>It worked perfectly, know we only need to make a funcion that calls all _backward() in all nodes recursively. Therefore we will use an algorithm for generating the topological order of the graph. That is, a linear order in which we can execute the nodes without causing any kind of dependency problem. Explaining this algorithm in depth is outside the scope of this project, but it is not that complicated, see below:</p>
<div id="e46e6236" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ... All methods of Value class</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> backward(<span class="va">self</span>):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.grad <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Montar ordem topologica</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    topo <span class="op">=</span> []</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    visited <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_topo(v):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="kw">not</span> <span class="kw">in</span> visited:</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            visited.add(v)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> child <span class="kw">in</span> v._prev:</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                build_topo(child)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            topo.append(v)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    build_topo(<span class="va">self</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> <span class="bu">reversed</span>(topo):</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        node._backward()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Know, lets test our backward function</p>
<div id="561c973c" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show Python code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Value:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data, _children<span class="op">=</span>(), _op<span class="op">=</span><span class="st">""</span>, label<span class="op">=</span><span class="st">""</span>):</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> data</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.grad <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._backward <span class="op">=</span> <span class="kw">lambda</span>: <span class="va">None</span> <span class="co"># Add this new parameter too save the func</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._prev <span class="op">=</span> <span class="bu">set</span>(_children) </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._op <span class="op">=</span> _op</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label <span class="op">=</span> label </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__mul__</span>(<span class="va">self</span>, other):</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span>  Value(<span class="va">self</span>.data <span class="op">*</span> other.data, (<span class="va">self</span>,other), <span class="st">'+'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _backward():</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.grad <span class="op">+=</span> other.data <span class="op">*</span> out.grad </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>            other.grad <span class="op">+=</span> <span class="va">self</span>.data <span class="op">*</span> out.grad</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        out._backward <span class="op">=</span> _backward</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is just for us visualize our class</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"Value(data=</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>data<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>, other):</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We just add the data, and return a Value object with new data, and with pointes for the two number that make the out number</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span>  Value(<span class="va">self</span>.data <span class="op">+</span> other.data, (<span class="va">self</span>,other), <span class="st">'+'</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _backward():</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.grad <span class="op">+=</span> out.grad </span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>            other.grad <span class="op">+=</span> out.grad</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        out._backward <span class="op">=</span> _backward</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> backward(<span class="va">self</span>):</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.grad <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Montar ordem topologica</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        topo <span class="op">=</span> []</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        visited <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> build_topo(v):</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> v <span class="kw">not</span> <span class="kw">in</span> visited:</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>                visited.add(v)</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> child <span class="kw">in</span> v._prev:</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>                    build_topo(child)</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>                topo.append(v)</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>        build_topo(<span class="va">self</span>)</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node <span class="kw">in</span> <span class="bu">reversed</span>(topo):</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>            node._backward()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="86734977" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> Value(<span class="fl">2.</span>, label<span class="op">=</span><span class="st">"a"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> Value(<span class="op">-</span><span class="fl">3.0</span>, label<span class="op">=</span><span class="st">"b"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Value(<span class="fl">10.</span>, label<span class="op">=</span><span class="st">"c"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> Value(<span class="op">-</span><span class="fl">2.</span>, label<span class="op">=</span><span class="st">"f"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> a <span class="op">*</span> b<span class="op">;</span> e.label<span class="op">=</span><span class="st">"e"</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> e <span class="op">+</span> c<span class="op">;</span> d.label<span class="op">=</span><span class="st">"d"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> d <span class="op">*</span> f<span class="op">;</span> L.label<span class="op">=</span><span class="st">"L"</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>L.backward() </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"L data: </span><span class="sc">{</span>L<span class="sc">.</span>data<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">20</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of L: </span><span class="sc">{</span>L<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be 1</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of f: </span><span class="sc">{</span>f<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be 4.0 (d.data)</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of d: </span><span class="sc">{</span>d<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -2.0 (f.data)</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of c: </span><span class="sc">{</span>c<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -2.0 (1 * d.grad)</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of e: </span><span class="sc">{</span>e<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -2.0 (1 * d.grad)</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of b: </span><span class="sc">{</span>b<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be -4.0 (a.data * e.grad -&gt; 2 * -2)</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Grad of a: </span><span class="sc">{</span>a<span class="sc">.</span>grad<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Should be 6.0 (b.data * e.grad -&gt; -3 * -2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>L data: -8.0
--------------------
Grad of L: 1
Grad of f: 4.0
Grad of d: -2.0
Grad of c: -2.0
Grad of e: -2.0
Grad of b: -4.0
Grad of a: 6.0</code></pre>
</div>
</div>
<p>It´s worked perfectly again, know we already have a functional AutoGrad system, know, it´s just need to add more operations and we will be capable of create our propely framework of Deep Learning using our own AutoGrad.</p>
</section>
</section>
<section id="lets-make-our-deep-learning-framework" class="level2">
<h2 class="anchored" data-anchor-id="lets-make-our-deep-learning-framework">Lets make our Deep Learning framework</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/deeplynoted\.net");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>